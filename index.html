<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ ìƒì„±ê¸°</title>

  <!-- ğŸ“± ë°˜ì‘í˜• & ê¸°ë³¸ ë©”íƒ€ -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ ìƒì„±ê¸° - ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ í…œí”Œë¦¿ì„ ê¸°ë°˜ìœ¼ë¡œ roll20ìš© í•¸ë“œì•„ì›ƒì„ ê°„í¸í•˜ê²Œ ìƒì„±í•˜ê³  ë³µì‚¬í•  ìˆ˜ ìˆëŠ” ë„êµ¬ì…ë‹ˆë‹¤.">
  <meta name="author" content="ë¬´ì§€ê°œë¶€ì—‰ì´">

  <!-- ğŸŒ Open Graph (SNS ë¯¸ë¦¬ë³´ê¸°ìš©) -->
  <meta property="og:title" content="ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ ìƒì„±ê¸°">
  <meta property="og:description" content="ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ ë¶ˆëŸ¬ì™€ ì†ì‰½ê²Œ í•¸ë“œì•„ì›ƒì„ ì œì‘í•˜ê³  ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https:/rainbowl-d.github.io/handoutMaker/thumbnail.png">
  <meta property="og:url" content="https:/rainbowl-d.github.io/handoutMaker/">

  <!-- ğŸ¦ Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ ìƒì„±ê¸°">
  <meta name="twitter:description" content="ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ í…œí”Œë¦¿ì„ ë¶ˆëŸ¬ì™€ ì†ì‰½ê²Œ í•¸ë“œì•„ì›ƒì„ ì œì‘í•˜ê³  ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.">
  <meta name="twitter:image" content="https:/rainbowl-d.github.io/handoutMaker/thumbnail.png">

  <!-- ğŸ§© íŒŒë¹„ì½˜ -->
  <link rel="icon" href="./favicon.ico" type="image/x-icon">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=IM+Fell+DW+Pica:ital@0;1&family=Kaushan+Script&display=swap');

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #f6f6f6;
      padding: 40px;
      color: #333;
      line-height: 1.6;
    }
    h2 { margin-bottom: 10px; }
    input, textarea, select {
      width: 100%; margin-bottom: 10px; padding: 8px;
      box-sizing: border-box; font-size: 14px;
      font-family: 'Noto Sans KR', sans-serif;
    }
    input:disabled, textarea:disabled, select:disabled {
      border: none; background: #e9e9e9; color: #888;
    }
    ol,ul{list-style: none; margin: 0; padding: 0;}
    table { border-collapse: collapse; }
    button {
      padding: 10px 20px; margin-right: 10px;
      cursor: pointer; font-weight: bold;
      border: none; border-radius: 5px;
      background: #252525; color: #fff;
    }
    .wrap {max-width: 750px; margin: 0 auto; }
    #preview {
      margin-top: 10px; background: #fff;
      padding: 20px; border: 1px solid #ddd;
    }
    .mt30{margin-top: 30px;}
    .desc{font-size: 13px;}

    /* ğŸ”¹ í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸° */
    .topBox { display: flex; justify-content: space-between; align-items: center; }
    #templatePreview {
      position: relative;
      display: flex; justify-content: center; align-items: center;
      background: #fff; border: 1px solid #ccc;
      width: 200px; height:240px;
      overflow: hidden;
    }
    #templatePreview > table {
      position: relative;
      padding: 0 !important;
      overflow: visible !important;
      transform: scale(0.4); transform-origin: center;
    }
    #templatePreview h1{margin: 0; line-height: 36px; font-size: 36px;}
    #templatePreview h2{margin: 0; font-size: 24px; line-height: 36px;}
    #templatePreview h3{margin: 0; line-height: 27px; font-size: 18px;}

    /* ğŸ”¹ ê°€ì´ë“œ íŒì—… */
    #guideBtn {
      position: fixed; right: 20px; bottom: 20px;
      background: #000000; color: #fff;
      padding: 10px 16px; border-radius: 6px;
      cursor: pointer; font-weight: bold; border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    #guidePopup {
      position: fixed; right: 20px; bottom: 70px;
      width: 40%; min-width: 320px; background: #fff;
      border: 1px solid #aaa; border-radius: 8px;
      padding: 16px; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      display: none; animation: fadeIn 0.3s;
      z-index: 999;
    }
    #guidePopup h3 { margin-top: 0; }
    @keyframes fadeIn {
      from {opacity:0; transform: translateY(10px);}
      to {opacity:1; transform: translateY(0);}
    }
  </style>
</head>
<body>

  <div class="wrap">
    <h2>ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ ìƒì„±ê¸°</h2>
    <p class="desc">ë¬´ì§€ê°œë¶€ì—‰ì´ í•¸ë“œì•„ì›ƒ í…œí”Œë¦¿ ì „ìš© í•¸ë“œì•„ì›ƒ ì…ë ¥ê¸° ì…ë‹ˆë‹¤.</p>
    <div class="topBox">
      <div>
        <label>í…œí”Œë¦¿ íŒŒì¼ ì—…ë¡œë“œ</label>
        <input type="file" id="templateFile" accept=".html,.txt">
      </div>
      <div id="templatePreview"></div>
    </div>

    <label for="templateSelect">í…œí”Œë¦¿ ì„ íƒ:</label>
    <select id="templateSelect" disabled>
      <option value="">í…œí”Œë¦¿ íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”</option>
    </select>

    <!-- ğŸ”¹ ì‚¬ìš©ì ì…ë ¥ -->
    <input id="imageUrl" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥ (ì˜ˆ: https://...)" disabled>
    <input id="handoutTitle" placeholder="í•¸ë“œì•„ì›ƒ íƒ€ì´í‹€ ì…ë ¥ (ì˜ˆ: HANDOUT)" disabled>
    <input id="subtitle" placeholder="ë¶€ì œëª© ì…ë ¥" disabled>
    <textarea id="content" placeholder="í•¸ë“œì•„ì›ƒ ë‚´ìš© ì…ë ¥ (ì¼ë¶€ ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì§€ì›í•©ë‹ˆë‹¤.)" rows="6" disabled></textarea>
    <input id="contentSub" placeholder="ë¶€ì—°ì„¤ëª… ì…ë ¥" disabled>

    <div class="btnBox">
      <button id="generateBtn">í•¸ë“œì•„ì›ƒ ìƒì„±</button>
    </div>

    <div class="topBox mt30">
      <h3>ë¯¸ë¦¬ë³´ê¸°</h3>
      <button id="copyBtn">í•¸ë“œì•„ì›ƒ ë³µì‚¬</button>
    </div>
    <div id="preview"></div>
  </div>

  <!-- ğŸ“˜ ê°€ì´ë“œ íŒì—… -->
  <button id="guideBtn">ğŸ“˜ ì‚¬ìš© ê°€ì´ë“œ</button>
  <div id="guidePopup">
    <h3>ğŸ“˜ ì‚¬ìš© ê°€ì´ë“œ</h3>
    <ol>
      <li>1ï¸âƒ£ ë¬´ì§€ê°œë¶€ì—‰ì´ê°€ ì œì‘í•œ í•¸ë“œì•„ì›ƒ í…œí”Œë¦¿(.html ë˜ëŠ” .txt)ì„ ì—…ë¡œë“œí•˜ì„¸ìš”.</li>
      <li>2ï¸âƒ£ í…œí”Œë¦¿ì„ ì„ íƒí•˜ê³  í•„ìš”í•œ ì…ë ¥ë€ì„ ì±„ìš°ì„¸ìš”. í…œí”Œë¦¿ë§ˆë‹¤ ì…ë ¥í• ìˆ˜ ìˆëŠ” ì…ë ¥ë€ì´ í™œì„±í™” ë©ë‹ˆë‹¤.</li>
      <li>3ï¸âƒ£ â€œí•¸ë“œì•„ì›ƒ ìƒì„±â€ ë²„íŠ¼ í´ë¦­ â†’ ë¯¸ë¦¬ë³´ê¸° í™•ì¸</li>
      <li>4ï¸âƒ£ â€œí•¸ë“œì•„ì›ƒ ë³µì‚¬â€ë¡œ í•¸ë“œì•„ì›ƒì„ í´ë¦½ë³´ë“œì— ì €ì¥!</li>
      <li>5ï¸âƒ£ roll20 ì‚¬ì´íŠ¸ì—ì„œ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ê¸°</li>
    </ol>
    <hr>
    <p><b>ğŸ“’ ì§€ì›ëŒ€ìƒ ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•</b><br>
      <code>**êµµê²Œ**</code> â†’ <strong>êµµê²Œ</strong><br>
      <code>*ê¸°ìš¸ê²Œ*</code> â†’ <em>ê¸°ìš¸ê²Œ</em><br>
      <code>~~ì·¨ì†Œì„ ~~</code> â†’ <del>ì·¨ì†Œì„ </del><br>
    </p>
    <hr>
    <p>ğŸ“ê¸°íƒ€ ë¬¸ì˜: <a href="https://x.com/rainbowl__D" target="_blank">@rainbowl__D</a></p>
  </div>

  <script>
    const generateBtn = document.getElementById('generateBtn');
    const copyBtn = document.getElementById('copyBtn');
    const preview = document.getElementById('preview');
    const templateSelect = document.getElementById('templateSelect');
    const templateFileInput = document.getElementById('templateFile');
    const templatePreview = document.getElementById('templatePreview');

    const imageUrlInput = document.getElementById('imageUrl');
    const titleInput = document.getElementById('handoutTitle');
    const subtitleInput = document.getElementById('subtitle');
    const contentInput = document.getElementById('content');
    const contentSubInput = document.getElementById('contentSub');

    const guideBtn = document.getElementById('guideBtn');
    const guidePopup = document.getElementById('guidePopup');

    let templates = [];
    let currentTable = null;

    /* âœ… ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ ë³€í™˜ê¸° */
    function convertMarkdownToHTML(mdText) {
      return mdText
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;").replace(/>/g, "&gt;")
        .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
        .replace(/\*(.*?)\*/g, "<em>$1</em>")
        .replace(/~~(.*?)~~/g, "<del>$1</del>")
        .replace(/\n/g, "<br>");
    }

    // ì…ë ¥ì°½ í™œì„±/ë¹„í™œì„±
    function toggleInputsByTemplate(index) {
      if (!templates.length || index === '' || index == null) return;
      const t = templates[index];
      imageUrlInput.disabled = !t.querySelector('.contentImg');
      titleInput.disabled = !t.querySelector('.title');
      subtitleInput.disabled = !t.querySelector('.subtitleSpan');
      contentInput.disabled = !t.querySelector('.contentSpan');
      contentSubInput.disabled = !t.querySelector('.contentSub');
    }

    // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
    function showTemplatePreview(index) {
      if (!templates.length || index === '' || index == null) {
        templatePreview.innerHTML = ''; return;
      }
      const tempTable = templates[index].cloneNode(true);
      const titleEl = tempTable.querySelector('.title');
      const subEl = tempTable.querySelector('.subtitleSpan');
      const contentEl = tempTable.querySelector('.contentSpan');
      const imgEl = tempTable.querySelector('.contentImg');
      const contentSubEl = tempTable.querySelector('.contentSub');

      if (titleEl) titleEl.textContent = 'HANDOUT';
      if (subEl) subEl.textContent = 'ë¶€ì œëª©';
      if (contentEl) contentEl.innerHTML = 'í•¸ë“œì•„ì›ƒ ë‚´ìš©';
      if (imgEl) imgEl.src = 'https://imgur.com/hpcTGc8.png';
      if (contentSubEl) contentSubEl.textContent = 'ë¶€ì—°ì„¤ëª…';

      templatePreview.innerHTML = '';
      templatePreview.appendChild(tempTable);
    }

    // âœ… íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
    templateFileInput.addEventListener('change', async (event) => {
      const file = event.target.files[0];
      if (!file) return;
      try {
        const text = await file.text();
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = text;
        const tables = Array.from(tempDiv.querySelectorAll('table[data-template_type]'));
        if (tables.length === 0) return alert('ìœ íš¨í•œ í…œí”Œë¦¿ì´ ì—†ìŠµë‹ˆë‹¤.');
        templates = tables;
        templateSelect.innerHTML = '';
        tables.forEach((tbl, i) => {
          const type = tbl.dataset.template_type || `í…œí”Œë¦¿ ${i + 1}`;
          const opt = document.createElement('option');
          opt.value = i; opt.textContent = type;
          templateSelect.appendChild(opt);
        });
        templateSelect.disabled = false;
        alert(`í…œí”Œë¦¿ ${tables.length}ê°œê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
        templateSelect.value = 0;
        showTemplatePreview(0);
        toggleInputsByTemplate(0);
      } catch (err) {
        console.error(err);
        alert('í…œí”Œë¦¿ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });

    // âœ… í…œí”Œë¦¿ ë³€ê²½ ì‹œ
    templateSelect.addEventListener('change', (e) => {
      showTemplatePreview(e.target.value);
      toggleInputsByTemplate(e.target.value);
    });

    // í•¸ë“œì•„ì›ƒ ìƒì„±
    generateBtn.addEventListener('click', () => {
      const idx = templateSelect.value;
      if (templates.length === 0) return alert('í…œí”Œë¦¿ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.');
      if (idx === '') return alert('í…œí”Œë¦¿ì„ ì„ íƒí•˜ì„¸ìš”.');

      const baseTable = templates[idx].cloneNode(true);
      const titleEl = baseTable.querySelector('.title');
      const subEl = baseTable.querySelector('.subtitleSpan');
      const contentEl = baseTable.querySelector('.contentSpan');
      const imgEl = baseTable.querySelector('.contentImg');
      const contentSubEl = baseTable.querySelector('.contentSub');

      if (titleEl && !titleInput.disabled)
        titleEl.textContent = titleInput.value || 'HANDOUT';
      if (subEl && !subtitleInput.disabled)
        subEl.textContent = subtitleInput.value || 'ë¶€ì œëª©';
      if (contentEl && !contentInput.disabled)
        contentEl.innerHTML = convertMarkdownToHTML(contentInput.value.trim() || 'í•¸ë“œì•„ì›ƒ ë‚´ìš©');
      if (imgEl && !imageUrlInput.disabled)
        imgEl.src = imageUrlInput.value || '';
      if (contentSubEl && !contentSubInput.disabled)
        contentSubEl.textContent = contentSubInput.value.trim() || 'ë¶€ì—°ì„¤ëª…';

      preview.innerHTML = '';
      preview.appendChild(baseTable);
      currentTable = baseTable.cloneNode(true);
    });

    // âœ… ë³µì‚¬
    copyBtn.addEventListener('click', async () => {
      if (!currentTable) return alert('ë¨¼ì € í…œí”Œë¦¿ì„ ìƒì„±í•˜ì„¸ìš”.');
      const html = currentTable.outerHTML;
      try {
        await navigator.clipboard.write([
          new ClipboardItem({
            'text/html': new Blob([html], { type: 'text/html' }),
            'text/plain': new Blob([html], { type: 'text/plain' })
          })
        ]);
        alert('í…œí”Œë¦¿ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      } catch (err) {
        console.error(err);
        alert('ë³µì‚¬ ì‹¤íŒ¨! HTTPS í™˜ê²½ ë˜ëŠ” ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.');
      }
    });

    // âœ… ê°€ì´ë“œ í† ê¸€
    guideBtn.addEventListener('click', () => {
      guidePopup.style.display = guidePopup.style.display === 'block' ? 'none' : 'block';
    });
  </script>
</body>
</html>
